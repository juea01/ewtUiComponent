<!DOCTYPE HTML>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>My Account</title>
	<link rel="stylesheet" href="dijit/themes/claro/claro.css" media="screen">
	<link rel="stylesheet" href="widget/css/MainStyle.css" media="screen">
	<link rel="stylesheet" href="widget/css/Animation.css" media="screen">
	
		<script>dojoConfig = {async: true, parseOnLoad: true}</script>
		<script src="dojo/dojo.js"></script>
	
	<!-- This is for header  --> 
		<script>
			require([
				"dojo/parser",
				"widget/StoreState",
				"widget/ContainerWidget",
				"widget/FooterWidget",
				"dijit/form/Button",
			], function(parser,StoreState) {
				// Invoke the dojo/parser
				parser.parse();
				var userDetail = sessionStorage.getItem('userDetail');
				
				if(userDetail=== null) {
					StoreState.storePageUrl(window.location.href);
					 window.location.replace('http://localhost:8080/EWTClientUi/Login.html'); 
				}
				
			});
		</script>
		
		
		
		<!-- This is for search box -->
		<script>
			require(["dojo","dojo/dom","dijit/form/Button","dojo/dom","dojo/store/Memory","dijit/form/FilteringSelect","widget/StoreState","dojo/store/JsonRest","dojo/domReady!"],
					function(dojo,dom,Button,dom,Memory,FilteringSelect,StoreState,JsonRest){
				
					var store = new JsonRest({
						target: "http://localhost:8080/EWTRestServices/rest/UtilityServices/productLists"
					});
				 
					var results = store.query({});
						results.then(function (productList) {
						var productStore = new Memory({
							data: productList
						});
						
						var filteringSelect = new  FilteringSelect({
							id: "productSelect",
							name: "Car",
							value: "CA",
							store: productStore,
							searchAttr: "name",
						},"productSelect").startup();
					});
				
					
					
					
							 
					
					var mySearchButton = new Button({
						label: "Search",
						onClick:function(){
							StoreState.storeSearchKeyWord(dijit.byId('productSelect').get('value'));
						window.location.replace('http://localhost:8080/EWTClientUi/Search.html');	
						}
					},"searchButtonNode").startup();
				
					});
		</script>
				
	</head>
	<body class="claro">
	<div id="container">
	<!-- This is for header -->
	<div data-dojo-type="widget/ContainerWidget">
		<div class="logo_div">
			<div>EWorldTradeLogo</div>
		</div>
		<div class="search_div">
			<input id="productSelect"/>
			<button id="searchButtonNode" type="button" ><img src="resources/search.png" class="searchButton" height="30" width="50"/></button>
		</div>
		<div class="login_Supplier_Wrapper_div">
		  <div class="listDeal_div">
			<a href="ListDeal.html">List Deal</a>
	      </div>
		  <div class="login_div">
			<a href="Login.html">Login In</a>  | <a href="Registration.html">Join Free</a>
		  </div>
		</div>
		
	</div>

	
	<div class="bodyContentWidget">
	<div class="sideBarMenuWidget">
		<a href="MyAccount.html">My Details</a> |
		<a href="MyListing.html">My Listing</a>
	</div>
	
	<div class = "middlealigned">
	<h2> Your Details</h2> 
	<script>

	require(["dojo/dom", "dojo/on", "dojo/request", "dojo/parser",
		/* dojox/ validate resources */
		"dojox/validate/web",
		/* basic dijit classes */ 
		"dijit/form/TextBox", "dijit/form/ValidationTextBox", "dijit/form/DateTextBox",
		 "dijit/form/Button", "dijit/form/RadioButton", "dijit/form/Form",
		/* basic dojox classes */
		"dojo/domReady!"], function(dom, on, request) {
		var userDetail = sessionStorage.getItem('userDetail');	
		userDetail = JSON.parse(userDetail);
		var myform =dijit.byId('myForm'); 
		myform.attr('value',userDetail); 
		
		
		 on(myform,"submit", function(event){
				
				//prevent the page form navigating after submit
				event.stopPropagation();
				event.preventDefault();
				
				if(this.validate()) {
					// Post the data to the server
					request.post("http://localhost:8080/EWTRestServices/rest/UserServices/users", {
						data: dojo.formToJson("myForm"),
						timeout: 5000
					}).then(function(response){
						dom.byId('serverMessage').innerHTML = response;
						
						// Post the data to the server
			  			request.get("http://localhost:8080/EWTRestServices/rest/UserServices/user/"+userDetail.userId, {
			  				timeout: 5000
			  			}).then(function(response){
			  				console.log(response);
			  				sessionStorage.setItem('userDetail',response);
			  			},function(error){
			  				console.log( error);
			  				dom.byId('serverMessage').innerHTML = "Status Code: " + error.response.status +" Message: " + error.response.data;
			  			});
						
					},function(error){
						dom.byId('serverMessage').innerHTML = "Status Code: " + error.response.status +" Message: " + error.response.data;
					});
				} else {
					alert('Form contains invalid data. Please correct first');
					console.log("Invalid data");
					return false;
				}
				
				
			}); 
		
	});
	
</script>
	<div data-dojo-type="dijit/form/Form" id="myForm" data-dojo-id="myForm"
		encType="multipart/form-data" >
<p id="serverMessage"></p>
 <br/>
<table>
<tr><td><input type="hidden" id="userId" name="userId" data-dojo-type="dijit/form/TextBox"/> </td></tr>
<tr> 
<td valign="top"><strong>First Name*:</strong> </td>  
<td><input type="text" required="true" name="userName" id="userName" placeholder="Your Name"
	data-dojo-type="dijit/form/ValidationTextBox" missingMessage="Ooops! You forgot your first name!"/></td>
</tr>
<tr><td><br/> </td> </tr>
<tr> 
<td valign="top"><strong>Email*:</strong> </td>
<td><input type="text" required="true" name="email" id="email" placeholder="Your Email"
	data-dojo-type="dijit/form/ValidationTextBox" validator="dojox.validate.isEmailAddress"/></td>
</tr>
<tr><td><br/> </td> </tr>
<tr> 
<td valign="top"><strong>Date of Birth*:</strong> </td>
<td><input type="text" required="true" name="dateOfBirth" id="dateOfBirth" placeholder="Your Birth day"
	data-dojo-type="dijit/form/DateTextBox" value="7/5/1983"/></td>
</tr>
<tr><td><br/> </td> </tr>
<tr> 
<td valign="top"><strong>Please select your gender:</strong> </td>
<td>
<input type="radio" id="radioMale" name="gender" value="Male" data-dojo-type="dijit/form/RadioButton"/>
<label for="radioMale">Male</label>
&nbsp;&nbsp;&nbsp;
<input type="radio" id="radioFemale" name="gender" value="Female" data-dojo-type="dijit/form/RadioButton"/>
<label for="radioFemale">Female</label>
&nbsp;&nbsp;&nbsp;
<input type="radio" id="radioLesbian" name="gender" value="Lesbian" data-dojo-type="dijit/form/RadioButton"/>
<label for="radioLesbian">Lesbian</label>
&nbsp;&nbsp;&nbsp;
<input type="radio" id="radioGay" name="gender"  value="Gay" data-dojo-type="dijit/form/RadioButton"/>
<label for="radioGay">Gay</label>
&nbsp;&nbsp;&nbsp;
<input type="radio" id="radioTransgender" name="gender" value="Transgender" data-dojo-type="dijit/form/RadioButton"/>
<label for="radioTransgender">Transgender</label>
&nbsp;&nbsp;&nbsp;
<input type="radio" id="radioOther" name="gender"  value="Other" data-dojo-type="dijit/form/RadioButton"/>
<label for="radioOther">Other</label>
</td>
</tr>
</table>
<button data-dojo-type="dijit/form/Button" type="submit" name="updateButton" value="Update">Update</button>
</div>

	</div>

	
	</div>	
	<!-- This is for footer -->
	<div data-dojo-type="widget/FooterWidget">
		<div class="footer_group1">
			<div><a href="AboutUs.html">About EWorldTrade</a></div>
			<div class="vertical_space">  </div>
			<div>Careers</div>
		</div>
		
		<div class="footer_group2">
			<div>Sell on EWorldTrade</div>
			<div class="vertical_space">  </div>
			<div>Own Store on EWorldTrade</div>
		</div>
		
		<div class="footer_group3">
			<div>Advertise</div>
			<div class="vertical_space">  </div>
			<div>Become Supplier</div>
		</div>
		
		<div class="footer_group4">
			<div>EWorldTrade Policy</div>
			<div class="vertical_space">  </div>
			<div>Return Goods</div>
			<div class="vertical_space">  </div>
			<div>Dispute Center</div>
			<div class="vertical_space">  </div>
			<div>Help</div>
		</div>
	</div>
		
</div>		
		
	</body>
</html>
